{% extends 'layouts/base.html' %}

{% block title %}Manuel Yedekleme{% endblock %}

{% block extra_css %}
<style>
    .info-card {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 2px solid #bae6fd;
        border-radius: 12px;
        padding: 20px;
    }
    
    .info-card-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        margin-bottom: 12px;
    }
    
    .feature-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .feature-list li {
        padding: 10px 0;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap:  10px;
    }
    
    .feature-list li:last-child {
        border-bottom: none;
    }
    
    .feature-list i {
        color: var(--primary-color);
        font-size: 18px;
    }
</style>
{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">
            <i class="bi bi-cloud-upload text-primary me-2"></i>
            Manuel Yedekleme
        </h2>
        <p class="text-muted mb-0">Firebird veritabanÄ± yedeÄŸi oluÅŸturun</p>
    </div>
    <div>
        <a href="{{ url_for('backup.index') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i>
            Geri
        </a>
    </div>
</div>

<!-- Form -->
<div class="row g-4">
    <div class="col-lg-8">
        <div class="stat-card">
            <form method="POST" action="{{ url_for('backup.create') }}" id="backupForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                
                <!-- Firma SeÃ§imi -->
                <div class="mb-4">
                    <label class="form-label">
                        <i class="bi bi-building"></i>
                        Firma
                        <span class="text-danger">*</span>
                    </label>
                    <select name="tenant_id" class="form-select" id="tenantSelect" required>
                        <option value="">Firma seÃ§in...</option>
                        {% for tenant in tenants %}
                        <option value="{{ tenant.id }}" 
                                data-db="{{ tenant.db_name }}"
                                data-kod="{{ tenant.kod }}">
                            {{ tenant.unvan }} ({{ tenant.kod }})
                        </option>
                        {% endfor %}
                    </select>
                    <small class="text-muted">
                        <i class="bi bi-info-circle"></i>
                        Yedeklenecek firmanÄ±n veritabanÄ±nÄ± seÃ§in
                    </small>
                </div>
                
                <!-- VeritabanÄ± Bilgisi -->
                <div id="dbInfo" class="alert alert-info" style="display: none;">
                    <i class="bi bi-database"></i>
                    <div>
                        <strong>VeritabanÄ±: </strong> <code id="dbName">-</code><br>
                        <small>Bu veritabanÄ± yedeklenecektir</small>
                    </div>
                </div>
                
                <!-- AÃ§Ä±klama -->
                <div class="mb-4">
                    <label class="form-label">
                        <i class="bi bi-pencil"></i>
                        AÃ§Ä±klama
                        <span class="text-muted">(Opsiyonel)</span>
                    </label>
                    <textarea name="description" 
                              class="form-control" 
                              rows="3"
                              placeholder="Ã–rn: AylÄ±k dÃ¼zenli yedekleme, YÄ±l sonu kapatma Ã¶ncesi yedek"></textarea>
                    <small class="text-muted">
                        <i class="bi bi-lightbulb"></i>
                        Bu yedekleme hakkÄ±nda not ekleyebilirsiniz
                    </small>
                </div>
                
                <!-- Yedekleme SeÃ§enekleri -->
                <div class="card border-primary mb-4">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-gear-fill me-2"></i>
                        Yedekleme AyarlarÄ±
                    </div>
                    <div class="card-body">
                        <div class="form-check">
                            <input class="form-check-input" 
                                   type="checkbox" 
                                   id="compress" 
                                   name="compress"
                                   checked>
                            <label class="form-check-label" for="compress">
                                <strong>
                                    <i class="bi bi-file-zip text-primary"></i>
                                    SÄ±kÄ±ÅŸtÄ±rma Uygula
                                </strong>
                                <small class="text-muted">
                                    Dosya boyutunu kÃ¼Ã§Ã¼ltÃ¼r (~65% tasarruf).Ã–nerilen ayar.
                                </small>
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" 
                                   type="checkbox" 
                                   id="verify" 
                                   name="verify"
                                   checked>
                            <label class="form-check-label" for="verify">
                                <strong>
                                    <i class="bi bi-shield-check text-success"></i>
                                    Yedek DoÄŸrulama
                                </strong>
                                <small class="text-muted">
                                    Yedekleme sonrasÄ± bÃ¼tÃ¼nlÃ¼k kontrolÃ¼ yapar.Daha gÃ¼venli.
                                </small>
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" 
                                   type="checkbox" 
                                   id="metadata"
                                   name="metadata">
                            <label class="form-check-label" for="metadata">
                                <strong>
                                    <i class="bi bi-table text-info"></i>
                                    Sadece Metadata
                                </strong>
                                <small class="text-muted">
                                    Veri olmadan sadece tablo yapÄ±sÄ±nÄ± yedekler (hÄ±zlÄ±).
                                </small>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- UyarÄ± -->
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    <div>
                        <strong>Ã–nemli UyarÄ±</strong>
                        <p class="mb-0">
                            Yedekleme sÄ±rasÄ±nda veritabanÄ± performansÄ± etkilenebilir.
                            YoÄŸun saatlerde (mesai saatleri) yedekleme yapmaktan kaÃ§Ä±nÄ±n.
                        </p>
                    </div>
                </div>
                
                <!-- Butonlar -->
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <i class="bi bi-cloud-upload"></i>
                        Yedeklemeyi BaÅŸlat
                    </button>
                    <a href="{{ url_for('backup.index') }}" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i>
                        Ä°ptal
                    </a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Bilgilendirme Sidebar -->
    <div class="col-lg-4">
        <!-- Yedekleme HakkÄ±nda -->
        <div class="stat-card mb-3">
            <div class="info-card-icon">
                <i class="bi bi-info-circle"></i>
            </div>
            <h5 class="mb-3">Yedekleme SÃ¼reci</h5>
            
            <ul class="feature-list">
                <li>
                    <i class="bi bi-1-circle-fill"></i>
                    <span>Firebird gbak komutu Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r</span>
                </li>
                <li>
                    <i class="bi bi-2-circle-fill"></i>
                    <span>VeritabanÄ± .FDB dosyasÄ± yedeklenir</span>
                </li>
                <li>
                    <i class="bi bi-3-circle-fill"></i>
                    <span>SÄ±kÄ±ÅŸtÄ±rma uygulanÄ±r</span>
                </li>
                <li>
                    <i class="bi bi-4-circle-fill"></i>
                    <span>GÃ¼venli dizine kaydedilir</span>
                </li>
            </ul>
        </div>
        
        <!-- Tahmini SÃ¼re -->
        <div class="stat-card mb-3" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #fbbf24;">
            <h6 class="mb-3">
                <i class="bi bi-clock-history text-warning"></i>
                Tahmini SÃ¼re
            </h6>
            <ul class="list-unstyled mb-0">
                <li class="mb-2">
                    <i class="bi bi-circle-fill text-success" style="font-size: 8px;"></i>
                    KÃ¼Ã§Ã¼k DB (&lt;100MB): <strong>1-2 dakika</strong>
                </li>
                <li class="mb-2">
                    <i class="bi bi-circle-fill text-warning" style="font-size: 8px;"></i>
                    Orta DB (100MB-1GB): <strong>2-5 dakika</strong>
                </li>
                <li>
                    <i class="bi bi-circle-fill text-danger" style="font-size: 8px;"></i>
                    BÃ¼yÃ¼k DB (&gt;1GB): <strong>5-15 dakika</strong>
                </li>
            </ul>
        </div>
        
        <!-- Depolama -->
        <div class="stat-card mb-3">
            <h6 class="mb-3">
                <i class="bi bi-hdd text-primary"></i>
                Depolama Konumu
            </h6>
            <p class="text-muted small mb-0">
                Yedekler gÃ¼venli bir dizine kaydedilir: <br>
                <code style="background: #f8fafc; padding: 4px 8px; border-radius: 6px; display: block; margin-top: 8px;">
                    D:\Backups\Muhasebe\
                </code>
            </p>
        </div>
        
        <!-- Ä°pucu -->
        <div class="alert alert-success">
            <i class="bi bi-lightbulb-fill"></i>
            <div>
                <strong>ğŸ’¡ Ä°pucu</strong>
                <p class="small mb-0">
                    Otomatik yedekleme iÃ§in 
                    <a href="{{ url_for('backup.schedule') }}" style="color: #065f46; font-weight: 600;">
                        zamanlama ayarlarÄ±nÄ±
                    </a> 
                    kullanÄ±n.
                </p>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Firma seÃ§ildiÄŸinde DB bilgisini gÃ¶ster
document.getElementById('tenantSelect').addEventListener('change', function() {
    const selected = this.options[this.selectedIndex];
    const dbName = selected.getAttribute('data-db');
    const dbInfo = document.getElementById('dbInfo');
    const dbNameSpan = document.getElementById('dbName');
    
    if (dbName) {
        dbNameSpan.textContent = dbName;
        dbInfo.style.display = 'flex';
        dbInfo.classList.add('animate__animated', 'animate__fadeIn');
    } else {
        dbInfo.style.display = 'none';
    }
});

// Form submit - loading state
document.getElementById('backupForm').addEventListener('submit', function(e) {
    const btn = document.getElementById('submitBtn');
    btn.classList.add('loading');
    btn.disabled = true;
    
    // SimÃ¼lasyon - gerÃ§ekte backend'den cevap gelene kadar bekler
    setTimeout(() => {
        btn.classList.remove('loading');
        btn.disabled = false;
    }, 3000);
});

// Form validasyonu
(function() {
    'use strict';
    
    const forms = document.querySelectorAll('form');
    
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            form.classList.add('was-validated');
        }, false);
    });
})();
</script>
{% endblock %}