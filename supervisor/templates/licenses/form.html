{% extends 'layouts/base.html' %}

{% block title %}{% if license %}Lisans DÃ¼zenle{% else %}Yeni Lisans{% endif %}{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">
            {% if license %}
            Lisans DÃ¼zenle
            {% else %}
            Yeni Lisans Ekle
            {% endif %}
        </h2>
        <p class="text-muted mb-0">
            {% if license %}
            {{ license.tenant.unvan }} lisansÄ±nÄ± gÃ¼ncelleyin
            {% else %}
            Firmaya yeni lisans atayÄ±n
            {% endif %}
        </p>
    </div>
    <div>
        <a href="{% if license %}{{ url_for('licenses.detail', license_id=license.id) }}{% else %}{{ url_for('licenses.index') }}{% endif %}" 
           class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>
            Geri
        </a>
    </div>
</div>

<!-- Form -->
<div class="row">
    <div class="col-lg-8">
        <div class="stat-card">
            <form method="POST" action="{% if license %}{{ url_for('licenses.edit', license_id=license.id) }}{% else %}{{ url_for('licenses.new') }}{% endif %}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                
                {% if not license %}
                <!-- Firma SeÃ§imi (Sadece Yeni Lisans) -->
                <div class="mb-3">
                    <label class="form-label">
                        Firma <span class="text-danger">*</span>
                    </label>
                    <select name="tenant_id" class="form-select" required>
                        <option value="">Firma SeÃ§in...</option>
                        {% for tenant in tenants %}
                        <option value="{{ tenant.id }}">{{ tenant.unvan }} ({{ tenant.kod }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Lisans Tipi -->
                <div class="mb-3">
                    <label class="form-label">
                        Lisans Tipi <span class="text-danger">*</span>
                    </label>
                    <select name="license_type" class="form-select" id="licenseType" required>
                        <option value="">SeÃ§in...</option>
                        <option value="trial">Deneme (30 GÃ¼n)</option>
                        <option value="starter">BaÅŸlangÄ±Ã§</option>
                        <option value="professional" selected>Profesyonel</option>
                        <option value="enterprise">Kurumsal</option>
                    </select>
                    <small class="text-muted">Lisans tipine gÃ¶re limitler otomatik ayarlanÄ±r</small>
                </div>
                
                <!-- SÃ¼re -->
                <div class="mb-3">
                    <label class="form-label">
                        Lisans SÃ¼resi (GÃ¼n) <span class="text-danger">*</span>
                    </label>
                    <select name="duration_days" class="form-select">
                        <option value="30">30 GÃ¼n (Deneme)</option>
                        <option value="90">90 GÃ¼n</option>
                        <option value="180">180 GÃ¼n</option>
                        <option value="365" selected>365 GÃ¼n (1 YÄ±l)</option>
                        <option value="730">730 GÃ¼n (2 YÄ±l)</option>
                    </select>
                </div>
                {% else %}
                <!-- DÃ¼zenleme - Firma gÃ¶ster -->
                <div class="mb-3">
                    <label class="form-label">Firma</label>
                    <input type="text" class="form-control" value="{{ license.tenant.unvan }}" readonly>
                </div>
                
                <!-- SÃ¼re Uzatma -->
                <div class="mb-3">
                    <label class="form-label">
                        SÃ¼re Uzat (GÃ¼n)
                    </label>
                    <input type="number" 
                           name="extend_days" 
                           class="form-control" 
                           placeholder="Ã–rn: 365"
                           min="0"
                           value="0">
                    <small class="text-muted">
                        Mevcut bitiÅŸ:  {{ license.valid_until.strftime('%d.%m.%Y') }}
                    </small>
                </div>
                {% endif %}
                
                <!-- KullanÄ±cÄ± Limiti -->
                <div class="mb-3">
                    <label class="form-label">
                        Maksimum KullanÄ±cÄ± SayÄ±sÄ± <span class="text-danger">*</span>
                    </label>
                    <input type="number" 
                           name="max_users" 
                           class="form-control" 
                           value="{{ license.max_users if license else 5 }}"
                           min="1"
                           max="1000"
                           required>
                </div>
                
                {% if not license %}
                <!-- Faturalama Bilgileri -->
                <hr class="my-4">
                <h5 class="mb-3">Faturalama (Opsiyonel)</h5>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">AylÄ±k Ãœcret (â‚º)</label>
                            <input type="number" 
                                   name="monthly_fee" 
                                   class="form-control" 
                                   placeholder="0.00"
                                   step="0.01"
                                   min="0">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Fatura DÃ¶nemi</label>
                            <select name="billing_cycle" class="form-select">
                                <option value="monthly">AylÄ±k</option>
                                <option value="yearly">YÄ±llÄ±k</option>
                            </select>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Butonlar -->
                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle me-2"></i>
                        {% if license %}GÃ¼ncelle{% else %}OluÅŸtur{% endif %}
                    </button>
                    <a href="{% if license %}{{ url_for('licenses.detail', license_id=license.id) }}{% else %}{{ url_for('licenses.index') }}{% endif %}" 
                       class="btn btn-outline-secondary">
                        Ä°ptal
                    </a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- YardÄ±m -->
    <div class="col-lg-4">
        <div class="stat-card">
            <h5 class="mb-3">
                <i class="bi bi-info-circle text-primary me-2"></i>
                Lisans Tipleri
            </h5>
            
            <div class="mb-3">
                <strong class="d-block mb-1">ğŸ¯ Deneme (Trial)</strong>
                <small class="text-muted">
                    â€¢ 30 gÃ¼n<br>
                    â€¢ 3 kullanÄ±cÄ±<br>
                    â€¢ 1 ÅŸube<br>
                    â€¢ Temel modÃ¼ller
                </small>
            </div>
            
            <div class="mb-3">
                <strong class="d-block mb-1">ğŸš€ BaÅŸlangÄ±Ã§ (Starter)</strong>
                <small class="text-muted">
                    â€¢ 1 yÄ±l<br>
                    â€¢ 5 kullanÄ±cÄ±<br>
                    â€¢ 1 ÅŸube<br>
                    â€¢ Stok, Cari, Fatura
                </small>
            </div>
            
            <div class="mb-3">
                <strong class="d-block mb-1">ğŸ’¼ Profesyonel</strong>
                <small class="text-muted">
                    â€¢ 1 yÄ±l<br>
                    â€¢ 20 kullanÄ±cÄ±<br>
                    â€¢ 5 ÅŸube<br>
                    â€¢ TÃ¼m modÃ¼ller + E-Fatura
                </small>
            </div>
            
            <div class="mb-3">
                <strong class="d-block mb-1">ğŸ¢ Kurumsal (Enterprise)</strong>
                <small class="text-muted">
                    â€¢ 1 yÄ±l<br>
                    â€¢ 100 kullanÄ±cÄ±<br>
                    â€¢ 50 ÅŸube<br>
                    â€¢ SÄ±nÄ±rsÄ±z Ã¶zellikler
                </small>
            </div>
        </div>
    </div>
</div>

{% endblock %}